name: 'HHU_Auto_Checkin'

on:
  workflow_dispatch:
  push:
    branches:
      - main
  schedule:
    - cron: '0 1,3 * * *'

jobs:
  auto_checkin:
    runs-on: ubuntu-latest
    steps:
      - name: 'Checkout codes'
        uses: actions/checkout@v2

      - name: 'Set python'
        uses: actions/setup-python@v1
        with:
          python-version: '3.x'

      - name: 'Install dependencies'
        run: |
          python -m pip install --upgrade selenium
      - name: 'Auto_Checkin'
        env:
          USERNAME: ${{ secrets.USERNAME }}
          PASSWORD: ${{ secrets.PASSWORD }}
        run: |
          echo "即将开始打卡"
          #随机时间打卡
          random_time=$(($RANDOM % 60))
          i=1
          while((i<=${random_time}))
          do
          echo "倒计时: $((${random_time}-$i)) 分钟"
          if [ $i > $((${random_time}-5)) ]
          then
          sleep $((${random_time}-$i))m
          else
          sleep 5m
          fi
          let i+=5
          done
          
          #执行主程序
          python main.py
